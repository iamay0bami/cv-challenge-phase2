# Cloud Automation & Deployment Pipeline 

This repository contains the complete automation suite for provisioning cloud infrastructure and deploying a containerized Application and Monitoring stack. By leveraging **Terraform** for Infrastructure as Code (IaC) and **Ansible** for Configuration Management, the entire environment is deployed with a single command.

---

## The "One-Command" Deployment
To provision the AWS infrastructure, configure the server, and deploy all services, run the following from the terraform directory:

```bash
terraform apply -auto-approve
```
---

**Architecture**
The deployment follows a modular architecture where Terraform handles the cloud layer and hands off the configuration to Ansible via a dynamic inventory.

## Architecture Diagram

<img width="1024" height="559" alt="image" src="https://github.com/user-attachments/assets/681146c7-c3d7-4b3e-8d6f-6e1be4d81474" />

---

## Core Components

- **Infrastructure**
  - AWS EC2 (Ubuntu 24.04)
  - Security Groups
  - Elastic IP

- **Reverse Proxy**
  - Traefik v3  
    *(Handles routing for all application and monitoring services)*

- **Application Stack**
  - **Frontend:** React *(Pulled from Docker Hub)*
  - **Backend:** FastAPI *(Pulled from Docker Hub)*
  - **Database:** PostgreSQL

- **Monitoring Stack**
  - **Metrics:** Prometheus & cAdvisor
  - **Logging:** Loki & Promtail
  - **Visualization:** Grafana  
    *(Pre-configured with data sources and dashboards)*

---

## Project Structure

```
.
â”œâ”€â”€ terraform/                # Infrastructure provisioning
â”‚   â”œâ”€â”€ main.tf               # EC2, Security Groups, EIP
â”‚   â”œâ”€â”€ outputs.tf            # Public IP and connection details
â”‚   â””â”€â”€ variables.tf           
â”œâ”€â”€ ansible/                  # Configuration & Deployment
â”‚   â”œâ”€â”€ roles/
â”‚   â”‚   â”œâ”€â”€ common/           # Docker installation & Version Locking
â”‚   â”‚   â”œâ”€â”€ app_stack/        # App deployment (Frontend, Backend, DB, Traefik)
â”‚   â”‚   â””â”€â”€ monitoring_stack/ # Observability (Prometheus, Grafana, Loki)
â”‚   â”œâ”€â”€ playbook.yml          # Main entry point for Ansible
â”‚   â””â”€â”€ inventory.ini         # Automatically generated by Terraform
â””â”€â”€ README.md
```

---

## Prerequisites

- **Terraform** installed locally.
- **Ansible** installed locally.
- **AWS CLI** configured with valid credentials.
- **SSH Key Pair** (Managed automatically by the Terraform logic).

---

##  Implementation Highlights & Challenges

### 1. Docker Version Pinning (The v29 Challenge)

During development, I encountered a breaking change in **Docker v29.x**, which enforces a minimum API version (**1.44**).  
This prevented **Traefik** from communicating with the Docker socket.

- **The Fix:**  
  I updated the Ansible `common` role to explicitly install **Docker v27.5.1**, utilize the `--allow-downgrades` flag, and apply `apt-mark hold` to lock the version.  
  This ensures the environment remains stable and fully compatible with Traefikâ€™s Docker provider.

---

### 2. Automated Inventory Management

Terraform manages the *â€œhandshakeâ€* between infrastructure and configuration by dynamically generating the `inventory.ini` file using a `local_file` resource.  
This guarantees that Ansible always has the correct **public IP address** and **SSH key path**, eliminating manual updates and configuration drift.

---

## ğŸ“Š Monitoring & Access

Once the deployment is complete, the services can be accessed via the following endpoints:

| Service              | Protocol / Port | Access Link                     |
|----------------------|------------------|----------------------------------|
| **Frontend App**     | HTTP (80)        | `http://<public_ip>`             |
| **Backend API**      | HTTP (8000)      | `http://<public_ip>/docs`         |
| **Traefik Dashboard**| HTTP (8080)      | `http://<public_ip>:8080`        |
| **Grafana**          | HTTP (3000)      | `http://<public_ip>/grafana`        |
| **Prometheus**       | HTTP (9090)      | `http://<public_ip>/prometheus`      |
